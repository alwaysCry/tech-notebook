# 公式系统

- 类型概览：

  - 技术指标公式

  - 条件选股公式

  - 专家系统公式：用于将买卖信号叠加至 K 线上

- 操作方式：

  - 公式管理：`Ctrl + F`

  - 条件选股：`Ctrl + T`

  - 叠加专家系统指示：`Ctrl + E`（须在 K 线界面中）

  - 切换五彩 K 线：`Ctrl + K`（须在 K 线界面中）

  - 移除已叠加专家系统指示，并还原 K 线：`Ctrl + H`（须在 K 线界面中）

## 函数详解

### 行情

- `OPEN`/`O`：返回当前周期的开盘价

- `CLOSE`/`C`：返回当前周期的收盘价

- `HIGH`/`H`：返回当前周期内的最高价

- `LOW`/`L`：返回当前周期内的最低价

- `VOL`/`V`：返回当前周期的成交量（手）

- `AMOUNT`：返回当前周期的成交额

- `ZSTJJ`：返回当前周期的分时图均价

### 统计

- `REF(X,A)`：引用 A 根 K 线前的 X 值。例：  
  首根（有效）K 线的收盘价：`REF(CLOSE, BARSCOUNT(C))`

- `REFDATE(X,A)`：引用 A 日期（_以 1900 年初为起点，按`[年数][月数][日数]`的形式表示_）的 X 值。例：  
  2001/12/08 的收盘价：`REFDATE(CLOSE,1011208)`

- `BARSCOUNT(X)`：返回自 X 有效以来至今的 K 线数。例：  
  有效的总 K 线数：`BARSCOUNT(CLOSE)`

- `BARSSINCE(X)`：首次条件成立（X 不为 0，下同）至今的 K 线数。例：  
  股价首超 10 元时至今的 K 线数：`BARSSINCE(HIGH>10)`

- `BARSSINCEN(X,N)`：最近 N 根 K 线内（_N 为 0 则从首根有效 K 线算起_）首次条件成立至今的 K 线数。例：  
  最近 10 根 K 线内股价首超 10 元时至今的 K 线数：`BARSSINCEN(HIGH>10,10)`

- `COUNT(X,N)`：最近 N 根 K 线内（_N 为 0 则从首根有效 K 线算起_）满足条件的 K 线数。例：  
  最近 20 根 K 线内收阳的 K 线数：`COUNT(CLOSE>OPEN,20)`

- `BARSLAST(X)`：上一次条件成立至今的 K 线数。例：  
  上一涨停板至今的 K 线数：`BARSLAST(CLOSE/REF(CLOSE,1) >= 1.1)`

- `BARSLASTCOUNT(X)`：从今往前，条件连续成立的 K 线数。例：  
  迄今连续收阳的 K 线数：`BARSLASTCOUNT(CLOSE>OPEN)`

- `HHV(X,N)`：最近 N 根 K 线内（_N 为 0 则从首根有效 K 线算起_）X 的最高值。例：  
  最近 30 根 K 线内的最高价：`HHV(HIGH,30)`

- `HHVBARS(X,N)`：X 在最近 N 根 K 线内（_N 为 0 则从首根有效 K 线算起_）达最高值时至今的 K 线数。例：  
  创迄今最高价时至今的 K 线数：`HHVBARS(HIGH,0)`

- `HOD(X,N)`：X 在最近 N 根 K 线内排名（_由高到低_）。例：  
  当前 K 线最高价在最近 20 根 K 线内排第几：`HOD(HIGH,20)`

- `LLV(X,N)`：最近 N 根 K 线内（_N 为 0 则从首根有效 K 线算起_） X 的最低值。例：  
  迄今历史最低价：`LLV(LOW,0)`

- `LLVBARS(X,N)`：X 在最近 N 根 K 线内（_N 为 0 则从首根有效 K 线算起_）达最低值时至今的 K 线数。例：  
  创最近 20 根 K 线内最低价时至今的 K 线数：`LLVBARS(LOW,0)`

- `LOD(X,N)`：X 在最近 N 根 K 线内的排名（_由低到高_）。例：  
  当前 K 线最低价在最近 20 根 K 线内排倒数第几：`LOD(LOW,20)`

- `HHVLLV(X,T,N1,N2)`：X 在距今 N1 到 N2（_N1 为 0 表示首根有效 K 线，N2 为 0 表示最后一根有效 K 线_）根 K 线间的最高（T=0）或最低值（T=1）

- `SUM(X,N)`：最近 N 根 K 线里 X 的总和（_N 为 0 则从首根有效 K 线算起_）。例：  
  近 5 根 K 线的成交量总和：`SUM(VOL,5)`

- `MULAR(X,N)`：最近 N 根 K 线里 X 的累积（_N 为 0 则从首根有效 K 线算起_）。例：
  近 5 天的复利：`MULAR(C/REF(C,1),5)`

### 逻辑

- `IF(X,A,B)`：条件成立则返回 A，否则返回 B。例：  
  若当前周期收阳则返回最高价，否则返回最低价：`IF(CLOSE>OPEN,HIGH,LOW)`

- `CROSS(A,B)`：A 从下往上穿过 B（成立返回 1，不成立返回 0，下同）。例：  
  5 日均线金叉 10 日均线：`CROSS(MA(CLOSE,5),MA(CLOSE,10))`

- `LONGCROSS(A,B,N)`：A 在最近 N 根 K 线内均小于 B 但最终上穿后者

- `UPNDAY(A,M)`：A 在最近 M 根 K 线均内连涨

- `DOWNNDAY(A,M)`：A 在最近 M 根 K 线均内连跌

- `NDAY(A,B,N)`：最近 N 根 K 线内 A 均大于 B。例：  
  最近 3 日连续收阳：`NDAY(CLOSE,OPEN,3)`

- `EXIST(X,N)`：最近 N 根 K 线内条件至少有一次成立。例：  
  最近 10 日存在阳线：`EXIST(CLOSE>OPEN,10)`

- `LAST(X,N1,N2)`：距今 N1 到 N2 根 K 线内（_N1 为 0 表示首根有效 K 线，N2 为 0 表示最后一根有效 K 线_）条件一直成立。例：

- `NOT(X)`：取反，条件成立时返回 0，否则返回 1

### 数学

- `MAX(A,B)`：返回 A 和 B 中的较大值

- `MIN(A<B)`：返回 A 和 B 中的较小值

- `ABS(X)`：返回 X 的绝对值

### 时间

- `PERIOD`：返回周期类型，对应关系如下：

  - `0`：1 分钟
  - `1`：5 分钟
  - `2`：15 分钟
  - `3`：30 分钟
  - `4`：60 分钟
  - `5`：日
  - `6`：周
  - `7`：月

- `DATE`：当前时间（_以 1900 年初为起点，按`[年数][月数][日数]`的形式表示_）。例：
  若当前日期为 2000/01/01，则返回 1000101
