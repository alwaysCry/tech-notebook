# 内建对象概述

## 数组

可通过以下语法创建**空数组**：

- 字面量形式

- `new Array([arrayLength | ...elementN])`（可不加 new）

  - 若传入单一非负整数，则返回长度为前者的空槽数组（空槽会在迭代中被跳过）

  - 否则，根据实参创建数组

引擎会尝试将元素逐个存储在连续区域以优化性能，前提为**不存在以下误用**：

- 为数组添加非数字键属性

- 以非连续、倒叙方式填充数组或直接为其`length`属性赋较大值，使其存在空槽

一些要点：

- 数组`length`属性实质而非元素个数，而是最大数字索引值加一，并且可写：

  - 若赋较大值则将插入空槽“补齐”

  - 若赋较小值将截断数组

  - 若赋 0 则清空数组

  ```js
  let arr = [];
  arr.length = 3; // 等价于 new Array(3)

  arr[30] = ["cat"];
  arr.length; // 31

  const cats = ["Dusty", "Misty", "Twiggy"];
  cats.length = 2;
  cats; // ['Dusty', 'Misty']

  cats.length = 0;
  cats; // []
  ```

- 不建议用`for...in`迭代数组，除会迭代出可能存在的非数字类型索引，其速度也较慢

- `Array.from(obj[, mapFn, thisArg])`将**类数组**或**可迭代**对象为转为数组。允许提供可选的映射函数，并为其指定`this`指向

## 类数组

**类数组**（array-like）对象是具有索引（整数属性）和`length`属性的对象

## 可迭代对象

- **可迭代**（Iterable）：实现`Symbol.iterator`方法的对象，该方法的返回值即**迭代器**（iterator），后者须实现`next`方法返回具有`done`和`value`字段的对象：前者表示迭代是否完成；后者即**迭代值**，`done`为`true`时将被忽略。要点：

  - 可以`for...of`迭代，适用 Spread 语法

  - 内建可迭代对象有：string、Array、Map、Set 等

  - 可迭代与迭代器可为同一对象，只需`Symbol.iterator`返回自身（this）即可

- **异步可迭代**：实现`Symbol.asyncIterator`方法的对象，该方法返回异步迭代器，后者`next`方法须返回 Promise 对象（或可用`async`方法）。可以`for await...of`迭代，但不适用 Spread 语法

一个对象可同时为可迭代与异步可迭代（虽然很怪）

## 解构赋值

解构赋值语法用于将“数组”/对象拆包至一系列变量中

“数组”解构形如`let [item1 = default, item2, ,...rest] = iterable`。要点：

- 右侧可为任意**可迭代对象**

- 左侧除变量外，也可为形如`obj.key`或`obj[key]`的对象属性

- 左侧可通过添加额外逗号来跳过元素

- 左侧成员可使用`=`提供默认值

- 左侧可以`...`后接参数以收集剩余**数组**项

- 可通过解构实现变量值交换

对象解构形如`let {prop : varName = default, ...rest} = object`。要点：

- 左侧成员可以`=`提供默认值，以`:`重命名变量

- 左侧可以`...`后接参数收集剩余对象属性

- 通过解构可获取到除 symbol 键外任意属性的值（包括不可枚举、继承）

注意 JS 将主代码流（即不在其他表达式中）的`{...}`当作一个代码块，因而若解构表达式前不带`let`/`const`则须用括号将其整个包裹。例如：

```js
let w, h;
({ w, h } = { w: 200, h: 100 });
```
